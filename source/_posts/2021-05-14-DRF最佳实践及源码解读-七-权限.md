---
title: DRF最佳实践及源码解读(七)--权限
date: 2020-04-19 15:08:12
categories:
- [Python, Web]
tags:
    - Django
    - Python
    - Restful
---

{% img /images/djangorestframework.png    '"DRF框架"' %}

<!-- more -->

## 使用

{% codeblock lang:python %}
"""
1.自定义认证类，继承rest_framework.permissions.BasePermission, 实现has_permission方法
2.视图类局部配置或全局配置
"""
from rest_framework.permissions import BasePermission


class MyPermission(BasePermission):

    def has_permission(self, request, view):
        if request.user.user_type != 3:
            return False    # 无权访问
        return True     # 有权访问
        
# 局部配置
class UserView(APIView):
    # 视图类中局部配置
    permission_classes = [MyPermission,]
    

# 全局配置
REST_FRAMEWORK = {
    'DEFAULT_PERMISSION_CLASSES': ['api.permissions.MyPermission']
}
{% endcodeblock %}

## 原理
{% codeblock lang:python %}

    def check_permissions(self, request):
        """
        Check if the request should be permitted.
        Raises an appropriate exception if the request is not permitted.
        """
        for permission in self.get_permissions():
            if not permission.has_permission(request, self):
                self.permission_denied(
                    request, message=getattr(permission, 'message', None)
                )
{% endcodeblock %}