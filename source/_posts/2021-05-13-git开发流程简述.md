---
title: git开发流程简述
date: 2020-07-06 16:24:43
tags: 
   - git
---


### 功能分支开发流简述

功能分支工作流是一种被证明的高效的多人合作开发模式，其核心思想是所有的功能开发都应该有一个专门的分支，而不是在主干分支上。这样的隔离模式可以方便多个开发者在各自的功能分支上开发而不会弄乱主干代码。另外也保证了主干分支的代码一定是没有问题可随时上线的，极大的有利于在集成环境中合作开发。

功能分支工作流也让code review 变得很方便，每个开发者在将自己的功能分支合并到主干分支（或迭代分支）时发起code review流程，由其他开发者审阅和讨论，这将有助于提升团队的代码质量。

功能分支工作流的总流程如下图所示：

<!-- more -->

{% img /images/git_flow.png  '"git分支工作流"' %}



### 一个日常示例

**拉取迭代分支**

PM周五召集RD们开需求会，确定下一阶段迭代需求的开发工作，会后开发负责人从master拉取了一个迭代分支

```bash
[work@dev web] (master) $ git pull
Already up to date.
[work@dev web] (master) $ git checkout -b iterative_20200706
Switched to a new branch 'iterative_20200706'
[work@dev web] (iterative_20200706) $ git push -u origin iterative_20200706
Branch 'iterative_20200706' set up to track remote branch 'iterative_20200706' from 'origin'.
```



**拉取功能分支**

RD们内部沟通并分解完任务后，分别从迭代分支拉取了各自的开发分支，并进入肝代码的节奏中

```bash
# 张三负责开发”工单系统“
[zhang3@dev web] (iterative_20200706) $ git pull
Already up to date.
[zhang3@dev web] (iterative_20200706) $ git checkout -b zhang3_issue
Switched to a new branch 'zhang3_issue'

# 李四负责开发”导出系统“
[li4@dev web] (iterative_20200706) $ git pull
Already up to date.
[li4@dev web] (iterative_20200706) $ git checkout -b li4_export
Switched to a new branch 'li4_export'

# 王五负责开发”安全洞察“
[wang5@dev web] (iterative_20200706) $ git pull
Already up to date.
[wang5@dev web] (iterative_20200706) $ git checkout -b wang5_insight
Switched to a new branch 'wang5_insight'
```



**提交功能分支代码**

周四晚上，工程师李四率先完成了自己的开发工作并自测完毕，决定提交Merge Request并发起code review流程，由具有代码合并权限的开发负责人审查后合并，然后向QA提测

```bash
# 查看修改的文件
[li4@dev web] (li4_export) $ git status -s
 M web/config.py
 
# 添加到暂存区
[li4@dev web] (li4_export) $ git add .

# 提交commit
[li4@dev web] (li4_export) $ git commit -m '李四关于导出系统的修改'
1 file changed, 5 insertions(+), 5 deletions(-)

# rebase 
[li4@dev web] (li4_export) $ git pull --rebase origin iterative_20200706
 * branch            iterative_20200706 -> FETCH_HEAD
Current branch li4_export is up to date.

# push
[li4@dev web] (li4_export) $ git push -u origin li4_export
 * [new branch]      li4_export -> li4_export
Branch 'li4_export' set up to track remote branch 'li4_export' from 'origin'.
```

李四做完以上操作后，去gitlab上发起Merge Request开始code review流程，如图所示：

{% img /images/git_mr.png  '"git提交mr"' %}



开发负责人需要履行自己审核代码的职责，认真阅读代码并且无异议后，将李四的代码合并到迭代分支。



**提交功能分支代码**

待其他工程师陆续完成自己的开发工作，各自创建了自己的code review流程并合并代码，并且QA也测试验收通过，确定达到上线标准。负责人需要将迭代分支合并到master上，完成本轮迭代开发。



### 线上紧急BUG处理

当发现线上出现故障或BUG，需要紧急处理时，直接从master拉取分支进行修复，流程如下图的红色部分：

{% img /images/git_flow_fix.png  '"git fix bug"' %}

在日常开发中，如果发现线上bug或是后期待优化的点，建议提交issue：

{% img /images/git_issue.png  '"git issue"' %}

issue建立后，基于issue创建对应的处理分支，后续在该分支上进行修复或开发

{% img /images/git_issue_br.png  '"git issue branch"' %}



### 精简版分支开发流程

在日常开发工作中，由于需求内容相对简单独立，并没有使用迭代开发的流程，这类项目适用于精简版的分支开发流程，如下图所示：

{% img /images/git_flow_mini.png  '"git flow mini"' %}


### 分支管理规范

1. 迭代分支命名规范

   迭代分支命名格式为”iteration_描述“，其中描述可以是迭代开始的日期，如"iteration_20200706"，也可以是功能描述，如"iteration_export"， 还可以是版本号，如”iteration_v1“。

2. 功能分支命名规范

   功能分支命名格式为"开发者_功能描述"，其中开发者信息不可缺失，如李四建立的开发分支为"lisi_export"，严禁分支取名为无意义的名字。

3. 紧急上线分支命名规范

   线上BUG紧急修复的分支命名格式为”开发\_功能描述\_hotfix“，hotfix后缀用来表示紧急修复。

4. Code Review规范

   合并代码前，必须走code review流程，严禁自己合并自己的代码，同时代码合并者必须起到review的作用，并且承担20%的故障责任。


