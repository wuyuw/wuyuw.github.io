---
title: DRF最佳实践及源码解读(八)--流量控制
date: 2020-04-19 15:18:12
categories:
- [Python, Web]
tags:
    - Django
    - Python
    - Restful
---

{% img /images/djangorestframework.png    '"DRF框架"' %}

<!-- more -->

## 使用

{% codeblock lang:python %}
# 针对认证用户和非认证用户进行限流

REST_FRAMEWORK = {
    'DEFAULT_THROTTLE_CLASSES': (
        'rest_framework.throttling.AnonRateThrottle',
        'rest_framework.throttling.UserRateThrottle'
    ),
    'DEFAULT_THROTTLE_RATES': {
        'anon': '4/day', # 匿名用户每天访问4次
        'user': '100/day'  # 登录用户访问100次
    }
}

# 针对不同视图设置不同频次

class ContactListView(APIView):
    throttle_scope = 'contacts'
    ...

class ContactDetailView(APIView):
    throttle_scope = 'contacts'
    ...

class UploadView(APIView):
    throttle_scope = 'uploads'
    ...
REST_FRAMEWORK = {
    'DEFAULT_THROTTLE_CLASSES': (
        'rest_framework.throttling.ScopedRateThrottle',
    ),
    'DEFAULT_THROTTLE_RATES': {
        'contacts': '1000/day',
        'uploads': '20/day'
    }
}

{% endcodeblock %}
